<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RifqyBudget – Login</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon.png" type="image/png">
  <meta name="theme-color" content="#6c5ce7">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #6c5ce7;
      --bg: #f8f9fa;
      --card: #ffffff;
      --text: #2d3436;
      --border: rgba(108,92,231,0.2);
      --danger: #e17055;
      --success: #00b894;
      --warning: #fdcb6e;
    }
    @media (prefers-color-scheme: dark) {
      :root { --bg: #2d3436; --card: #353b48; --text: #dfe6e9; --border: rgba(108,92,231,0.3); }
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 16px; }
    
    .container { width: 100%; max-width: 900px; }
    .header { text-align: center; margin-bottom: 32px; }
    h1 { font-size: 32px; color: var(--primary); }
    .subtitle { font-size: 16px; opacity: 0.8; margin-top: 8px; }

    .grid { display: grid; gap: 16px; grid-template-columns: 1fr; }
    @media (min-width: 768px) { .grid { grid-template-columns: 1fr 1fr; } }

    .card { background: var(--card); border-radius: 16px; padding: 24px; box-shadow: 0 6px 20px rgba(0,0,0,0.08); border: 1px solid var(--border); }
    .input-group { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
    input, select, button { padding: 14px; border-radius: 12px; font-size: 16px; }
    input, select { border: 2px solid var(--border); background: var(--bg); color: var(--text); flex: 1; min-width: 100px; }
    button { background: var(--primary); color: white; border: none; cursor: pointer; font-weight: 600; min-width: 80px; }
    button:hover { opacity: 0.9; }
    .btn-reset { background: var(--warning); color: #2d3436; margin-top: 16px; width: 100%; font-weight: 600; }

    .stats { display: flex; justify-content: space-between; font-size: 20px; font-weight: bold; margin: 16px 0; }
    .total-expense { color: var(--danger); }
    .remaining { color: var(--success); }

    .chart-container { height: 240px; margin: 16px 0; }
    .expense-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border); font-size: 15px; }
    .expense-amount { font-weight: 600; color: var(--danger); }

    .budget-input { display: flex; gap: 8px; margin-top: 16px; }
    .budget-input input { flex: 1; }
    .budget-input button { min-width: 60px; }

    .login-card { max-width: 400px; margin: 0 auto; text-align: center; }
    .login-card input { width: 100%; margin-bottom: 16px; }
    .login-card button { width: 100%; }

    .hidden { display: none; }
    footer { text-align: center; margin-top: 40px; font-size: 12px; opacity: 0.7; }
  </style>
</head>
<body>

  <!-- LOGIN PAGE -->
  <div id="login-page" class="container">
    <div class="login-card card">
      <div class="header">
        <h1>RifqyBudget</h1>
        <p class="subtitle">Login untuk mulai catat keuangan</p>
      </div>
      <input type="text" id="username" placeholder="Masukkan Nama" autocomplete="off">
      <button onclick="login()">Masuk</button>
    </div>
  </div>

  <!-- MAIN APP (HIDDEN AWALNYA) -->
  <div id="app" class="container hidden">
    <div class="header">
      <h1>RifqyBudget</h1>
      <p class="subtitle">Selamat datang, <span id="user-name"></span>!</p>
    </div>

    <div class="grid">
      <!-- INPUT -->
      <div class="card">
        <div class="input-group">
          <input type="text" id="desc" placeholder="Deskripsi (contoh: Beli Beras)">
          <input type="number" id="amount" placeholder="Rp">
        </div>
        <div class="input-group">
          <select id="category">
            <option>Makan</option>
            <option>Transport</option>
            <option>Belanja</option>
            <option>Hiburan</option>
            <option>Lainnya</option>
          </select>
          <button onclick="addExpense()">Tambah</button>
        </div>
      </div>

      <!-- STATS & BUDGET -->
      <div class="card">
        <div class="stats">
          <div>Total: <span id="total-expense" class="total-expense">Rp0</span></div>
          <div>Sisa: <span id="remaining" class="remaining">Rp0</span></div>
        </div>
        <div class="budget-input">
          <input type="number" id="budget" placeholder="Budget Bulanan">
          <button onclick="setBudget()">Set</button>
        </div>
        <button class="btn-reset" onclick="resetAll()">Reset Semua Data</button>
        <button style="margin-top:8px; background:#e74c3c; width:100%;" onclick="logout()">Logout</button>
      </div>
    </div>

    <!-- GRAFIK -->
    <div class="card">
      <h3 style="text-align:center; margin-bottom:12px; font-size:17px;">Grafik Pengeluaran Bulanan</h3>
      <div class="chart-container">
        <canvas id="monthlyChart"></canvas>
      </div>
    </div>

    <!-- LIST -->
    <div class="card">
      <h3 style="margin-bottom:12px; font-size:17px;">Pengeluaran Bulan Ini</h3>
      <div id="expenses-list">
        <div style="text-align:center; opacity:0.6; font-size:15px;">Belum ada pengeluaran.</div>
      </div>
    </div>

    <footer>© 2025 RifqyBudget – Hanya untuk <span id="footer-name"></span></footer>
  </div>

  <script>
    let currentUser = null;
    let expenses = [];
    let budget = 0;
    let monthlyChart;

    // Cek login
    function checkLogin() {
      const saved = localStorage.getItem('rifqyBudget_user');
      if (saved) {
        currentUser = saved;
        document.getElementById('login-page').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        document.getElementById('user-name').textContent = currentUser;
        document.getElementById('footer-name').textContent = currentUser;
        loadUserData();
      }
    }

    // Login
    function login() {
      const name = document.getElementById('username').value.trim();
      if (!name) return alert('Masukkan nama dulu!');
      currentUser = name;
      localStorage.setItem('rifqyBudget_user', name);
      document.getElementById('login-page').classList.add('hidden');
      document.getElementById('app').classList.remove('hidden');
      document.getElementById('user-name').textContent = name;
      document.getElementById('footer-name').textContent = name;
      loadUserData();
    }

    // Logout
    function logout() {
      if (confirm('Yakin ingin logout?')) {
        currentUser = null;
        localStorage.removeItem('rifqyBudget_user');
        document.getElementById('app').classList.add('hidden');
        document.getElementById('login-page').classList.remove('hidden');
        document.getElementById('username').value = '';
      }
    }

    // Load data per user
    function loadUserData() {
      const key = `rifqyBudget_${currentUser}`;
      expenses = JSON.parse(localStorage.getItem(key) || '[]');
      budget = parseInt(localStorage.getItem(`${key}_limit`) || '0');
      updateUI();
    }

    // Save data
    function saveData() {
      const key = `rifqyBudget_${currentUser}`;
      localStorage.setItem(key, JSON.stringify(expenses));
      localStorage.setItem(`${key}_limit`, budget);
    }

    function getMonthKey(date) {
      const d = new Date(date);
      return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
    }

    function addExpense() {
      const desc = document.getElementById('desc').value.trim();
      const amount = parseInt(document.getElementById('amount').value);
      const category = document.getElementById('category').value;
      if (!desc || !amount) return alert('Isi deskripsi & jumlah!');

      expenses.push({ desc, amount, category, date: new Date().toISOString() });
      document.getElementById('desc').value = '';
      document.getElementById('amount').value = '';
      saveData();
      updateUI();
    }

    function setBudget() {
      const val = parseInt(document.getElementById('budget').value);
      if (!val) return;
      budget = val;
      document.getElementById('budget').value = '';
      saveData();
      updateUI();
    }

    function resetAll() {
      if (confirm('Yakin hapus SEMUA data pengeluaran dan budget?')) {
        expenses = [];
        budget = 0;
        saveData();
        updateUI();
        alert('Data telah direset!');
      }
    }

    function updateUI() {
      const currentMonth = getMonthKey(new Date());
      const monthExpenses = expenses.filter(e => getMonthKey(e.date) === currentMonth);
      const total = monthExpenses.reduce((a, c) => a + c.amount, 0);

      document.getElementById('total-expense').textContent = `Rp${total.toLocaleString('id-ID')}`;
      document.getElementById('remaining').textContent = budget > 0 ? `Rp${(budget - total).toLocaleString('id-ID')}` : '-';

      const list = document.getElementById('expenses-list');
      if (monthExpenses.length === 0) {
        list.innerHTML = '<div style="text-align:center; opacity:0.6; font-size:15px;">Belum ada pengeluaran.</div>';
      } else {
        list.innerHTML = monthExpenses.map(e => `
          <div class="expense-item">
            <div>${e.desc} <small>(${e.category})</small></div>
            <div class="expense-amount">-Rp${e.amount.toLocaleString('id-ID')}</div>
          </div>
        `).join('');
      }

      // Grafik
      const months = [];
      const data = [];
      for (let i = 5; i >= 0; i--) {
        const d = new Date();
        d.setMonth(d.getMonth() - i);
        const key = getMonthKey(d);
        months.push(d.toLocaleDateString('id-ID', { month: 'short', year: 'numeric' }));
        const monthTotal = expenses.filter(e => getMonthKey(e.date) === key).reduce((a, c) => a + c.amount, 0);
        data.push(monthTotal);
      }

      if (monthlyChart) monthlyChart.destroy();
      monthlyChart = new Chart(document.getElementById('monthlyChart'), {
        type: 'line',
        data: { labels: months, datasets: [{ label: 'Pengeluaran', data, borderColor: '#e17055', backgroundColor: 'rgba(225,112,85,0.1)', fill: true, tension: 0.3 }] },
        options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { callback: v => 'Rp' + v.toLocaleString('id-ID') } } } }
      });
    }

    // INIT
    checkLogin();
  </script>
</body>
        </html>
